# 🚀 Electron IPC 演示指南

这个演示应用展示了 Electron 中实现安全、可维护的进程间通信的最佳实践。

## 🎯 核心特性演示

### 1. 安全的上下文隔离

**位置**: 应用的安全设计贯穿整个架构

**关键代码**:
```typescript
// main.ts - 安全的 webPreferences 配置
webPreferences: {
  preload: path.join(__dirname, 'preload.js'),
  contextIsolation: true,    // 完全隔离上下文
  nodeIntegration: false,    // 禁用 Node.js 访问
  sandbox: false,            // 允许 preload 脚本运行
}
```

**演示效果**: 渲染进程无法直接访问 Node.js API，只能通过 preload 暴露的安全 API 进行通信。

### 2. 类型安全的 IPC 通信

**位置**: `src/common/ipc.ts` - 统一的类型定义

**关键特性**:
- 集中化的通道名管理
- 完整的 TypeScript 类型定义
- 编译时类型检查

**演示效果**: 
```typescript
// 类型安全的 API 调用
const user = await window.electronAPI.user.getById('1');
// TypeScript 会检查参数类型和返回值类型
```

### 3. 输入验证和错误处理

**位置**: `src/main/ipc/handlers.ts` - Zod 验证

**关键代码**:
```typescript
const CreateUserSchema = z.object({
  name: z.string().min(1, 'Name is required'),
  email: z.string().email('Valid email is required'),
  role: z.enum(['admin', 'user']),
});
```

**演示**: 在用户管理页面尝试创建无效数据的用户，系统会显示详细的验证错误。

### 4. 实时事件通信

**位置**: 所有演示模块都有事件监听

**演示步骤**:
1. 打开两个用户管理标签页（如果可能）
2. 在一个页面创建/更新/删除用户
3. 观察另一个页面实时收到事件通知

**关键代码**:
```typescript
// 监听用户创建事件
const unsubscribe = window.electronAPI.user.onCreated((user) => {
  console.log('新用户创建:', user);
});
```

## 🔍 详细功能演示

### 用户管理模块

**位置**: 点击 "👥 用户管理" 标签

**演示功能**:
1. **CRUD 操作**: 创建、查看、编辑、删除用户
2. **数据验证**: 尝试输入无效邮箱或空名称
3. **实时事件**: 观察日志中的事件通知
4. **错误处理**: 尝试删除不存在的用户

**演示脚本**:
```
1. 创建新用户: 姓名"张三", 邮箱"zhang@test.com", 角色"用户"
2. 查看用户详情: 点击任意用户的"查看"按钮
3. 编辑用户: 点击"编辑"按钮，修改信息
4. 观察日志: 查看右侧日志面板的实时更新
```

### 文件操作模块

**位置**: 点击 "📁 文件操作" 标签

**演示功能**:
1. **安全的文件操作**: 路径验证和权限控制
2. **进度监控**: 大文件操作的实时进度
3. **错误处理**: 文件不存在或权限错误

**演示脚本**:
```
1. 创建配置文件: 点击"创建配置文件"按钮
2. 写入文件: 输入内容并点击"写入文件"
3. 读取文件: 点击"读取文件"查看内容
4. 测试大文件: 点击"测试大文件"观察进度条
5. 检查文件存在: 使用"检查存在"功能
```

### 系统信息模块

**位置**: 点击 "💻 系统信息" 标签

**演示功能**:
1. **系统信息获取**: CPU、内存、平台信息
2. **系统功能调用**: 打开文件夹、显示通知
3. **实时监控**: 内存使用率显示

**演示脚本**:
```
1. 查看系统信息: 页面加载时自动获取
2. 打开文件夹: 输入路径或使用快速按钮
3. 发送通知: 自定义通知内容并发送
4. 观察内存使用: 查看实时内存使用率
```

### 任务管理模块

**位置**: 点击 "⚙️ 任务管理" 标签

**演示功能**:
1. **异步任务**: 模拟长时间运行的任务
2. **进度监控**: 实时进度更新
3. **任务控制**: 取消正在运行的任务
4. **状态管理**: 任务的完整生命周期

**演示脚本**:
```
1. 创建任务: 使用预设按钮或自定义任务
2. 观察进度: 查看进度条和状态更新
3. 并发任务: 同时创建多个任务
4. 取消任务: 在任务运行时点击"取消"
5. 查看统计: 底部的任务状态统计
```

### 高级功能模块

**位置**: 点击 "🚀 高级功能" 标签

**演示功能**:
1. **重试机制**: 自动重试失败的请求
2. **批量处理**: 并发控制的批量操作
3. **缓存系统**: 提高性能的缓存机制
4. **队列管理**: 优先级队列和负载控制

**演示脚本**:
```
1. 测试重试: 配置重试参数并测试
2. 批量调用: 观察并发处理过程
3. 缓存测试: 比较有无缓存的性能差异
4. 队列管理: 添加不同优先级的任务
5. 查看状态: 监控缓存和队列的实时状态
```

## 📊 日志系统

**位置**: 右侧日志面板

**功能**:
- 实时记录所有操作
- 按类型过滤（信息、成功、错误）
- 自动滚动和手动控制
- 操作统计

**使用技巧**:
1. 使用过滤器查看特定类型的日志
2. 关闭自动滚动可以暂停在某个位置查看
3. 清空日志可以重新开始观察

## 🎓 学习要点

### 1. 安全设计模式
- 永远不要在渲染进程中直接使用 `ipcRenderer`
- 通过 preload 脚本暴露类型安全的 API
- 启用上下文隔离，禁用 Node.js 集成

### 2. 错误处理策略
- 使用 schema 验证输入数据
- 提供有意义的错误信息
- 实现重试和降级机制

### 3. 性能优化
- 使用缓存减少重复请求
- 实现队列管理控制并发
- 批量处理减少 IPC 开销

### 4. 用户体验
- 提供实时反馈和进度指示
- 实现事件驱动的数据更新
- 优雅的错误提示和恢复

## 🚀 扩展建议

基于这个演示，你可以扩展以下功能：

1. **数据持久化**: 集成数据库（SQLite、MongoDB）
2. **文件处理**: 支持拖放、预览、转换
3. **网络通信**: HTTP 客户端、WebSocket 连接
4. **系统集成**: 更多系统 API、硬件访问
5. **性能监控**: 详细的性能指标和报告

## 🔍 调试技巧

1. **开发者工具**: F12 打开渲染进程调试
2. **主进程调试**: 使用 `console.log` 或 Node.js 调试器
3. **IPC 通信**: 在 handlers.ts 中添加日志
4. **网络面板**: 查看 IPC 调用的性能
5. **错误堆栈**: 使用 try-catch 捕获详细错误

这个演示展示了构建生产级 Electron 应用所需的所有核心概念和最佳实践。通过学习和实践这些模式，你可以构建安全、高性能、可维护的桌面应用程序。
